ARG VERSION
ARG TARGETARCH

FROM public.ecr.aws/amazoncorretto/amazoncorretto:$VERSION

## see https://technology.blog.gov.uk/2015/12/11/using-jemalloc-to-get-to-the-bottom-of-a-memory-leak/
ADD jemalloc-binaries/${TARGETARCH} /opt/jemalloc

ENV \
  PATH=$PATH:/opt/jemalloc/bin \
  LD_PRELOAD=/opt/jemalloc/lib/libjemalloc.so

ADD wait-for-it.sh /usr/local/bin/

RUN yum update -y \
    && yum install -y tar gzip procps which \
    && yum clean all

